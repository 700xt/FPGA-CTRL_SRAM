library ieee;
use ieee.std_logic_1164.all;

entity tb_fsm is
end entity;

architecture tb of tb_fsm is

    ------------------------------------------------------------------
    -- Constantes
    ------------------------------------------------------------------
    constant CLK_PERIOD : time := 10 ns;

    ------------------------------------------------------------------
    -- Signaux
    ------------------------------------------------------------------
    signal clk      : std_logic := '0';
    signal reset    : std_logic := '0';
    signal ctrl_RW  : std_logic := '0';
    signal RW       : std_logic := '0';

    -- Sorties FSM
    signal Rw_n, Trig_s : std_logic;

begin

    ------------------------------------------------------------------
    -- Génération de l'horloge
    ------------------------------------------------------------------
    clk <= not clk after CLK_PERIOD / 2;

    ------------------------------------------------------------------
    -- Instanciation de la FSM
    ------------------------------------------------------------------
    dut : entity work.fsm(Behavioral)  
        port map (
            Clk     => clk,
            reset   => reset,
            ctrl_RW => ctrl_RW,
            RW      => RW,

            Rw_n   => Rw_n,
            Trig_s => Trig_s
        );

    ------------------------------------------------------------------
    -- Stimuli
    ------------------------------------------------------------------
    stim_proc : process
    begin
        --------------------------------------------------------------
        -- Reset
        --------------------------------------------------------------
        reset <= '1';
        wait for 20 ns;
        reset <= '0';

        -- Après reset : INIT ? IDLE
        wait for CLK_PERIOD * 2;

        --------------------------------------------------------------
        -- IDLE ? READ
        --------------------------------------------------------------
        ctrl_RW <= '1';
        RW      <= '1';
        wait for CLK_PERIOD;

        --------------------------------------------------------------
        -- READ ? WRITE
        --------------------------------------------------------------
        RW <= '0';
        wait for CLK_PERIOD;

        --------------------------------------------------------------
        -- WRITE ? WRITE (maintien)
        --------------------------------------------------------------
        wait for CLK_PERIOD;

        --------------------------------------------------------------
        -- WRITE ? IDLE
        --------------------------------------------------------------
        ctrl_RW <= '0';
        wait for CLK_PERIOD;

        --------------------------------------------------------------
        -- IDLE ? READ ? IDLE
        --------------------------------------------------------------
        ctrl_RW <= '1';
        RW      <= '1';
        wait for CLK_PERIOD;

        ctrl_RW <= '0';
        wait for CLK_PERIOD;

        --------------------------------------------------------------
        -- Fin de simulation
        --------------------------------------------------------------
        wait;
    end process;

end architecture;
